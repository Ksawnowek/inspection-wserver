<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raport Serwisowy - GH CRANES - Zadanie {{ naglowek.ZNAG_Id }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @page {
            size: A4;
        }

        body {
            background-color: #f8f9fa;
            font-size: 0.9rem;
        }
        .report-container {
            background: white;
            max-width: 1200px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .header-section {
            border: 2px solid #000;
            padding: 15px;
            margin-bottom: 20px;
        }
        .logo-section {
            background-color: transparent;
            color: #000;
            padding: 20px 5px;
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
        }
        .section-title {
            background-color: #000;
            color: white;
            padding: 5px 10px;
            font-weight: bold;
            margin: 15px 0 10px 0;
        }
        .form-table {
            width: 100%;
            border-collapse: collapse;
        }
        .form-table td, .form-table th {
            border: 1px solid #000;
            padding: 8px;
        }
        .checkbox-group label {
            margin-right: 20px;
        }
        .signature-box {
            border: 1px solid #000;
            padding: 15px;
            margin-top: 20px;
        }
        .dynamic-content {
            min-height: 150px;
            border: 1px solid #dee2e6;
            padding: 15px;
            background-color: #f8f9fa;
        }
        .signature-img {
            max-width: 200px;
            max-height: 60px;
            display: block;
        }
        /* Automatyczne rozszerzanie tekstu */
        .auto-expand {
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: pre-wrap;
        }
        /* Zapobieganie przecinaniu między stronami */
        .no-break {
            page-break-inside: avoid;
            break-inside: avoid;
        }
        .row.no-break {
            page-break-inside: avoid;
            break-inside: avoid;
        }
        .form-table tr {
            page-break-inside: avoid;
            break-inside: avoid;
        }
        /* Sekcja z nagłówkiem i zawartością razem */
        .section-block {
            page-break-inside: avoid;
            break-inside: avoid;
            margin-bottom: 10px;
        }
        .section-block .section-title {
            margin-bottom: 0;
        }
        /* Zmniejszony padding dla pól tekstowych */
        .text-field {
            border: 1px solid #dee2e6;
            padding: 8px;
            min-height: 60px;
            background-color: #f8f9fa;
        }
        @media print {
            body {
                background-color: white;
            }
            .report-container {
                box-shadow: none;
                margin: 0;
            }
        }
    </style>
</head>
<body>
    <div class="report-container">
        <!-- Nagłówek -->
        <div class="row mb-3">
            <div class="col-12 text-end">
                <strong>Data:</strong> <span id="report-date">{{ today }}</span>
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-3">
                <div class="logo-section" style="display: flex; align-items: center; justify-content: center;">
                    {% if logo_url %}
                        <img src="{{ logo_url }}" alt="GH SERWIS" style="max-height: 80px; max-width: 100%;">
                    {% else %}
                        <span>GH<br>SERWIS</span>
                    {% endif %}
                </div>
            </div>
            <div class="col-9">
                <div class="header-section">
                    <h4 class="mb-3">ZADANIE NR: <span id="task-number">{{ naglowek.ZNAG_Id }}</span></h4>

                    <div class="row mb-2">
                        <div class="col-6">
                            <strong>KLIENT:</strong> <span id="client-id">{{ naglowek.ZNAG_KlientNumer }}</span> <span id="client-name">{{ naglowek.ZNAG_KlientNazwa or '' }}</span>
                        </div>
                        <div class="col-6">
                            <strong>TELEFON:</strong> <span id="phone">{{ naglowek.ZNAG_KlientTelefon or '' }}</span>
                        </div>
                    </div>

                    <div class="row mb-2">
                        <div class="col-6">
                            <strong>ADRES:</strong> <span id="address">{{ naglowek.ZNAG_KlientAdres or '' }}</span>
                        </div>
                        <div class="col-6">
                            <strong>KONTAKT:</strong> <span id="contact">{{ naglowek.ZNAG_KlientNazwisko or '' }}</span>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-4">
                            <strong>MIASTO:</strong> <span id="city">{{ naglowek.ZNAG_KlientMiasto or '' }}</span>
                        </div>
                        <div class="col-4">
                            <strong>POWIAT:</strong> <span id="county">{{ naglowek.ZNAG_KlientPowiat or '' }}</span>
                        </div>
                        <div class="col-4">
                            <strong>STANOWISKO:</strong> <span id="position">{{ naglowek.ZNAG_KlientDzial or '' }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Typ prac -->
        <div class="row mb-3">
            <div class="col-12">
                <div class="checkbox-group border p-3">
                    <label><input type="checkbox" id="awaria" {% if naglowek.ZNAG_TypPrzegladu == 'W' %}checked{% endif %}> AWARIA</label>
                    <label><input type="checkbox" id="prace-rozne"> PRACE RÓŻNE</label>
                    <label><input type="checkbox" id="konserwacja" {% if naglowek.ZNAG_TypPrzegladu in ['A','B'] %}checked{% endif %}> KONSERWACJA</label>
                    <label><input type="checkbox" id="montaz"> MONTAŻ I URUCHOMIENIE</label>
                </div>
            </div>
        </div>

        <!-- Dane zadania - lepszy układ -->
        <div class="row mb-2 no-break">
            <div class="col-6">
                <strong>TYP PRZEGLĄDU:</strong> <span class="auto-expand">{{ naglowek.ZNAG_TypPrzegladu or '' }}</span>
            </div>
            <div class="col-6">
                <strong>CZĘSTOTLIWOŚĆ:</strong> <span class="auto-expand">{{ naglowek.ZNAG_Czestotliwosc or '' }}</span>
            </div>
        </div>

        <div class="row mb-2 no-break">
            <div class="col-6">
                <strong>DATA PLANOWANA:</strong> <span class="auto-expand">{{ naglowek.ZNAG_DataPlanowana.strftime('%d-%m-%Y') if naglowek.ZNAG_DataPlanowana else '' }}</span>
            </div>
            <div class="col-6">
                <strong>DATA WYKONANIA:</strong> <span class="auto-expand">{{ naglowek.ZNAG_DataWykonania.strftime('%d-%m-%Y') if naglowek.ZNAG_DataWykonania else '' }}</span>
            </div>
        </div>

        <div class="row mb-3 no-break">
            <div class="col-12">
                <strong>PRZYPISANE OSOBY:</strong> <span class="auto-expand">{{ naglowek.ZNAG_Osoby or '' }}</span>
            </div>
        </div>

        <!-- Opis prac - tylko urządzenia zakwalifikowane do przeglądu -->
        <div class="section-block">
            <div class="section-title">OPIS PRAC</div>
            <table class="form-table">
            <thead>
                <tr>
                    <th width="25%">urządzenie</th>
                    <th width="25%">opis</th>
                    <th width="25%">urządzenie</th>
                    <th width="25%">opis</th>
                </tr>
            </thead>
            <tbody id="work-description">
                {% for pair in pozycje|selectattr('ZPOZ_UrzadzenieDoPrzegladu')|batch(2, fill_with=None) %}
                <tr>
                    {% for p in pair %}
                        {% if p %}
                            <td>{{ p.ZPOZ_UrzadzenieNumer }}</td>
                            <td>{{ p.ZPOZ_UrzadzenieOpis }}</td>
                        {% else %}
                            <td></td>
                            <td></td>
                        {% endif %}
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
        </div>

        <!-- Obserwacje -->
        <div class="section-block">
            <div class="section-title">OBSERWACJE SERWISANTÓW</div>
            <div class="text-field auto-expand">{{ naglowek.ZNAG_Uwagi or '' }}</div>
        </div>

        <!-- Wykorzystane godziny -->
        <div class="section-block">
            <div class="section-title">WYKORZYSTANE GODZINY</div>
            <div class="dynamic-content">
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td width="30%"><strong>Godziny świąteczne:</strong></td>
                        <td>{{ naglowek.ZNAG_GodzSwieta or '' }}</td>
                    </tr>
                    <tr>
                        <td><strong>Godziny sobota/noc:</strong></td>
                        <td>{{ naglowek.ZNAG_GodzSobNoc or '' }}</td>
                    </tr>
                    <tr>
                        <td><strong>Godziny dojazdu:</strong></td>
                        <td>{{ naglowek.ZNAG_GodzDojazdu or '' }}</td>
                    </tr>
                    <tr>
                        <td><strong>Godziny naprawy:</strong></td>
                        <td>{{ naglowek.ZNAG_GodzNaprawa or '' }}</td>
                    </tr>
                    <tr>
                        <td><strong>Godziny wyjazd:</strong></td>
                        <td>{{ naglowek.ZNAG_GodzWyjazd or '' }}</td>
                    </tr>
                    <tr>
                        <td><strong>Dieta:</strong></td>
                        <td>{{ naglowek.ZNAG_GodzDieta or '' }}</td>
                    </tr>
                    <tr>
                        <td><strong>Kilometry:</strong></td>
                        <td>{{ naglowek.ZNAG_GodzKm or '' }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
        </div>

        <!-- Zgoda klienta -->
        <div class="signature-box no-break">
            <div class="row">
                <div class="col-6">
                    <strong>Zgoda Klienta</strong>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-6">
                    <strong>Nazwisko:</strong> {{ naglowek.ZNAG_KlientNazwisko or '____________________________' }}
                </div>
                <div class="col-6">
                    <strong>Data podpisu:</strong> {{ naglowek.ZNAG_DataPodpisu.strftime('%d-%m-%Y %H:%M') if naglowek.ZNAG_DataPodpisu else (naglowek.ZNAG_KlientDataZatw.strftime('%d-%m-%Y') if naglowek.ZNAG_KlientDataZatw else '____________________________') }}
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-6">
                    <strong>Podpis:</strong>
                    {% if podpis_klient %}
                        <div class="mt-2">
                            <img src="{{ podpis_klient }}" class="signature-img" alt="Podpis Klienta">
                        </div>
                    {% else %}
                        ____________________________
                    {% endif %}
                </div>
                <div class="col-6">
                    <strong>Dział:</strong> {{ naglowek.ZNAG_KlientDzial or '____________________________' }}
                </div>
            </div>
        </div>

        <!-- Stopka -->
        <div class="text-center mt-4 small">
            <p class="mb-0">GH CRANES SP. Z O.O Tel.: +48 34 3597317 - Fax: +48 34 3598410 E-MAIL: serwis@ghsa.pl</p>
        </div>
    </div>

    